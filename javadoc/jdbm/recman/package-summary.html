<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_20) on Tue Jul 13 19:13:03 IST 2010 -->
<TITLE>
jdbm.recman (JDBM JavaDoc)
</TITLE>

<META NAME="date" CONTENT="2010-07-13">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="jdbm.recman (JDBM JavaDoc)";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Package</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../jdbm/htree/package-summary.html"><B>PREV PACKAGE</B></A>&nbsp;
&nbsp;NEXT PACKAGE</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../index.html?jdbm/recman/package-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="package-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<H2>
Package jdbm.recman
</H2>
Core classes for managing persistent objects and processing transactions.
<P>
<B>See:</B>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#package_description"><B>Description</B></A>
<P>

<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Interface Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/BlockView.html" title="interface in jdbm.recman">BlockView</A></B></TD>
<TD>This is a marker interface that is implemented by classes that
  interpret blocks of data by pretending to be an overlay.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/Magic.html" title="interface in jdbm.recman">Magic</A></B></TD>
<TD>This interface contains magic cookies.</TD>
</TR>
</TABLE>
&nbsp;

<P>

<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Class Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/BaseRecordManager.html" title="class in jdbm.recman">BaseRecordManager</A></B></TD>
<TD>This class manages records, which are uninterpreted blobs of data.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/BlockIo.html" title="class in jdbm.recman">BlockIo</A></B></TD>
<TD>This class wraps a page-sized byte array and provides methods
  to read and write data to and from it.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/CacheRecordManager.html" title="class in jdbm.recman">CacheRecordManager</A></B></TD>
<TD>A RecordManager wrapping and caching another RecordManager.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/CacheRecordManager.CacheEntry.html" title="class in jdbm.recman">CacheRecordManager.CacheEntry</A></B></TD>
<TD>&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/CacheRecordManager.SoftCacheEntry.html" title="class in jdbm.recman">CacheRecordManager.SoftCacheEntry</A></B></TD>
<TD>&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/CacheRecordManager.SoftRunnable.html" title="class in jdbm.recman">CacheRecordManager.SoftRunnable</A></B></TD>
<TD>Runs in separate thread and cleans SoftCache.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/DataPage.html" title="class in jdbm.recman">DataPage</A></B></TD>
<TD>Class describing a page that holds data.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/FileHeader.html" title="class in jdbm.recman">FileHeader</A></B></TD>
<TD>This class represents a file header.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/FreeLogicalRowIdPage.html" title="class in jdbm.recman">FreeLogicalRowIdPage</A></B></TD>
<TD>Class describing a page that holds logical rowids that were freed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/FreeLogicalRowIdPageManager.html" title="class in jdbm.recman">FreeLogicalRowIdPageManager</A></B></TD>
<TD>This class manages free Logical rowid pages and provides methods
  to free and allocate Logical rowids on a high level.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/FreePhysicalRowIdPage.html" title="class in jdbm.recman">FreePhysicalRowIdPage</A></B></TD>
<TD>Class describing a page that holds physical rowids that were freed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/FreePhysicalRowIdPageManager.html" title="class in jdbm.recman">FreePhysicalRowIdPageManager</A></B></TD>
<TD>This class manages free physical rowid pages and provides methods
  to free and allocate physical rowids on a high level.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/Location.html" title="class in jdbm.recman">Location</A></B></TD>
<TD>This class represents a location within a file.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/LogicalRowIdManager.html" title="class in jdbm.recman">LogicalRowIdManager</A></B></TD>
<TD>This class manages the linked lists of logical rowid pages.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/PageCursor.html" title="class in jdbm.recman">PageCursor</A></B></TD>
<TD>This class provides a cursor that can follow lists of pages
  bi-directionally.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/PageHeader.html" title="class in jdbm.recman">PageHeader</A></B></TD>
<TD>This class represents a page header.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/PageManager.html" title="class in jdbm.recman">PageManager</A></B></TD>
<TD>This class manages the linked lists of pages that make up a file.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/PhysicalRowIdManager.html" title="class in jdbm.recman">PhysicalRowIdManager</A></B></TD>
<TD>This class manages physical row ids, and their data.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/Provider.html" title="class in jdbm.recman">Provider</A></B></TD>
<TD>Provider of the default RecordManager implementation.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/RecordFile.html" title="class in jdbm.recman">RecordFile</A></B></TD>
<TD>This class represents a random access file as a set of fixed size
  records.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/RecordHeader.html" title="class in jdbm.recman">RecordHeader</A></B></TD>
<TD>The data that comes at the start of a record of data.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/TransactionManager.html" title="class in jdbm.recman">TransactionManager</A></B></TD>
<TD>This class manages the transaction log that belongs to every
  <A HREF="../../jdbm/recman/RecordFile.html" title="class in jdbm.recman"><CODE>RecordFile</CODE></A>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/TransactionManager.BlockIoComparator.html" title="class in jdbm.recman">TransactionManager.BlockIoComparator</A></B></TD>
<TD>INNER CLASS.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../jdbm/recman/TranslationPage.html" title="class in jdbm.recman">TranslationPage</A></B></TD>
<TD>Class describing a page that holds translations from physical rowids
  to logical rowids.</TD>
</TR>
</TABLE>
&nbsp;

<P>
<A NAME="package_description"><!-- --></A><H2>
Package jdbm.recman Description
</H2>

<P>
<p>Core classes for managing persistent objects and processing transactions.</p>

        <h1>Memory allocation</h1>
        This document describes the memory allocation structures and
algorithms used by jdbm.  It is based on a thread in the
jdbm-developers mailing list.
<p/>
<ul>
<li> A block is a fixed length of bytes.  Also known as a page.
<li> A row is a variable length of bytes.  Also known as a record.
<li> A slot is a fixed length entry in a given block/page.
<li> A page list is a linked list of pages.  The head and tail of each
  page list is maintained in the file header.
</ul>
Jdbm knows about a few page lists which are pre-defined in Magic,
e.g., Magic.USED_PAGE.  The FREE, USED, TRANSLATION, FREELOGIDS, and
FREEPHYSIDS page lists are used by the jdbm memory allocation policy
and are described below.
<p/>
The translation list consists of a bunch of slots that can be
available (free) or unavailable (allocated).  If a slot is available,
then it contains junk data (it is available to map the logical row id
associated with that slot to some physical row id).  If it is
unavailable, then it contains the block id and offset of the header of
a valid (non-deleted) record.  "Available" for the translation list
is marked by a zero block id for that slot.
<p/>
The free logical row id list consists of a set of pages that contain
slots.  Each slot is either available (free) or unavailable
(allocated).  If it is unavailable, then it contains a reference to
the location of the available slot in the translation list.  If it is
available, then it contains junk data. "Available" slots are marked by
a zero block id.  A count is maintained of the #of available slots
(free row ids) on the page.
<p/>
As you free a logical row id, you change it's slot in the translation
list from unavailable to available, and then *add* entries to the free
logical row list.  Adding entries to the free logical row list is done
by finding an available slot in the free logical row list and
replacing the junk data in that slot with the location of the now
available slot in the translation list.  A count is maintained of the
#of available slots (free row ids) on the page.
 <p/>
Whew... now we've freed a logical row id.  But what about the physical
row id?
<p/> 
Well, the free physical row id list consists of a set of pages that
contain slots.  Each slot is either available (free) or unavailable
(allocated).  If it is unavailable, then it contains a reference to
the location of the newly freed row's header in the data page.  If it
is available, then it contains junk data.  "Available" slots are
marked by a zero block id.  A count is maintained of the #of available
slots (free row ids) on the page. (Sound familiar?)
<p/> 
As you free a physical row id, you change it's header in the data page
from inuse to free (by zeroing the size field of the record header),
and then *add* an entry to the free physical row list.  Adding entries
to the free physical row list consists of finding an available slot,
and replacing the junk data in that slot with the location of the
newly freed row's header in the data page.
<p/>
The translation list is used for translating in-use logical row ids
to in-use physical row ids.  When a physical row id is freed, it is
removed from the translation list and added to the free physical row
id list.
<p/> 
This allows a complete decoupling of the logical row id from the
physical row id, which makes it super easy to do some of the fiddling
I'm talking about the coallescing and splitting records.
<p/> 
If you want to get a list of the free records, just enumerate the
unavailable entries in the free physical row id list.  You don't even
need to look up the record header because the length of the record is
also stored in the free physical row id list.  As you enumerate the
list, be sure to not include slots that are available (in the current
incarnation of jdbm, I believe the available length is set to 0 to
indicate available - we'll be changing that some time soon here, I'm
sure).
<p/>
<P>

<P>
<DL>
</DL>
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Package</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../jdbm/htree/package-summary.html"><B>PREV PACKAGE</B></A>&nbsp;
&nbsp;NEXT PACKAGE</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../index.html?jdbm/recman/package-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="package-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>
Cees de Groot (C) 2000-2001. All rights reserved  http://jdbm.sourceforge.net
</BODY>
</HTML>
